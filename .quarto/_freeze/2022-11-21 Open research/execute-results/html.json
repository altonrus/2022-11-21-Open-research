{
  "hash": "e77f786b3f160ce065c8542de40ec782",
  "result": {
    "markdown": "---\ntitle: \"Open and reproducible research workflows\"\nsubtitle: \"MCHI research group meeting\"\nauthor: \"Alton Russell\"\ndate: \"21 Nov 2023\"\nformat: revealjs\neditor: visual\n---\n\n\n## Agenda\n\n-   **Overview**\n\n-   My workflow\n\n-   Example\n\nFollow along\n\n-   Github repository <https://github.com/altonrus/2022-11-21-Open-research>\n\n-   Slides in web browser <https://htmlpreview.github.io/?https://github.com/altonrus/2022-11-21-Open-research/blob/main/2022-11-21%20Open%20research.html#/title-slide>\n\n## Reproducible\n\nCan be exactly redone, given same materials\n\n-   Code\n\n-   Environment\n\n-   Data[^1]\n\n[^1]: Adapted from [Telling Stories with Data by Rohan Alexander](https://tellingstorieswithdata.com/04-workflow.html)\n\n## Reproducible for whom?\n\n-   Can **you** run your entire workflow again?\n\n-   Can **another person** run your entire workflow again?\n\n-   Can **\"future-you\"** run your entire workflow again?\n\n-   Can **\"future-another-person\"** run your entire workflow again?[^2]\n\n[^2]: Adapted from [Telling Stories with Data by Rohan Alexander](https://tellingstorieswithdata.com/04-workflow.html)\n\n## Reproducible outputs\n\n::: columns\n::: {.column width=\"50%\"}\nNecessary conditions\n\n-   Code\n\n-   Datasets\n\n-   Info to reconstruct environment\n:::\n\n::: {.column width=\"50%\"}\nOverachieving\n\n-   Code-generated manuscripts\n\n-   Functional docker-container\n\n-   Apps/widgets to run model/interrogate analysis\n:::\n:::\n\n## Paradigm shift\n\nManuscript is an advertisement\n\n\"Product\" is:\n\n-   Code\n\n-   Data\n\n-   Shiny tool\n\n-   etc.\n\n## Why people don't share code?\n\n-   Didn't have to\n\n-   It's not 'clean enough'\n\n-   Want to keep competitive edge\n\n-   Mistakes might be found\n\n## Why people don't share code?\n\n-   Didn't have to\n\n-   It's not 'clean enough'\n\n-   Want to keep competitive edge\n\n-   Mistakes might be found\n\nUsually, not good reasons\n\n## Why should we share code?\n\n-   Fully communicate methods\n\n-   Research as a public good\n\n-   More potential contribution\n\n-   Mistakes might be found\n\n-   Can increase citations\n\n**Messy code \\>\\>\\> No code!**\n\n## \"Data available on request\"\n\nGabelica et. al.[^3] found:\n\n[^3]: Gabelica, Bojčić, and Puljakc 2022. *Journal of Clinical Epidemiology* 2022. <https://doi.org/10.1016/j.jclinepi.2022.05.019>\n\n-   3416 of 3556 articles (96%) included data availability statements\n\n-   1782 (42%) indicated data available on request, **but**\n\n    -   1528 (86%) did not respond\n\n    -   131 (7%) declined to share\n\n    -   123 (7%) shared their data\n\n## Can't share data due to privacy?\n\nCode is very useful even without data\n\n-   Helps communicate your methods\n\n-   Others can adapt + run on their own data\n\nIncrease reproducibility without sharing data with\n\n-   'Data dictionary' in supplement\n\n-   Synthetic data\n\n## Environment\n\n-   R and packages updated all the time\n\n-   No guarantees of backwards compatibility\n\n-   Potential solutions\n\n    -   [renv package](https://rstudio.github.io/renv/) for **r**eproducible **env**ironments\n\n    -   Docker containers\n\n## R projects\n\n-   Self contained set of files (data, scripts, reports)\n\n-   Portable **if** all file paths relative to project directory\n\n    -   Bad:`\"\\Users\\alton\\projects\\COVID\\data\\dat.csv\"`\n\n    -   Bad: `setwd(\"\\Users\\alton\\projects\\COVID\")`\n\n    -   Good: `\"1_data\\dat_file.csv\"`\n\n## Each script should run error-free in new session\n\nUse console when designing code, but 'restart r and clear output' for 'production.\n\nChange global options to maximize reproducibility\n\n![](figs/rstudio-global-options.jpeg)\n\n## Literate programming\n\nIdea of Donald Knuth: Code snippets and 'natural language' (English) interspersed in one document\n\n-   **Jupyter notebooks** Python, Julia\n\n-   **RMarkdown** R, Python with some extra steps\n\n-   **Quarto documents** R, Python, Julia\n\n    -   You're looking at one\n\n## Agenda\n\n-   Overview\n\n-   **My workflow**\n\n-   Example\n\n## R project organization\n\n::: columns\n::: {.column width=\"40%\"}\n![](figs/generic-project-directory.png){width=\"399\"}\n:::\n\n::: {.column width=\"60%\"}\n-   **1_data** (self-explanatory)\n\n-   **2_scripts** code not embedded in manuscript\n\n-   **3_intermediate** intermediate outputs\n\n-   **4_output** figures, tables that will be read into the manuscript\n\n-   **5_manuscipt** .Rmd or .qmd manuscript\n:::\n:::\n\n## .gitignore\n\n::: columns\n::: {.column width=\"30%\"}\n![](figs/gitignore-example.png)\n:::\n\n::: {.column width=\"70%\"}\nAny folder or file you don't want on github\n\n-   \"local\" folder for data use agreements, conference presentations, etc.\n\n-   \"private\" folders for objects that cannot be made public\n\nI keep Github repos private at first, but they become public when I publish.\n\n**If sensitive data were ever in repo, hard to remove!**\n:::\n:::\n\n## **Git**hub in RStudio\n\n::: columns\n::: {.column width=\"65%\"}\n![](figs/github-in-rstudio.png)\n:::\n\n::: {.column width=\"35%\"}\n-   Can pull, commit, and push within Rstudio\n\n-   Use terminal for more complex things\n\n-   Also works in Rstudio server!\n:::\n:::\n\n## RMarkdown/Quarto documents\n\n-   Quarto will eventually replace RMarkdown\n\n-   Some RMarkdown packages don't work in Quarto\n\n-   \"Knit\" (RMarkdown) or \"Render\" (Quarto) to:\n\n    -   HTML (this document)\n\n    -   PDF\n\n    -   Word\n\n    -   Powerpoint\n\n## Literate programming (.Rmd or .Qmd)\n\n### Code chunks\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nfread(\"1_data/data.csv\")\n```\n:::\n\n\n### Inline code\n\n![](figs/example-inline-code.png)\n\n↓\n\n> The mean cost per person was \\$1,212\n\n## My Manuscript template\n\n-   .Rmd that knits to Microsoft Word\n\n    -   Collaborators can track changes\n    -   Some medical journals still prefer Word\n\n-   Requires a .bib file for bibliography\n\n    -   Can make with [Zotero](https://www.zotero.org/) or Mendeley\n\n-   Use [flextable package](https://davidgohel.github.io/flextable/reference/index.html) to make pretty tables\n\n## Manuscript template .Rmd\n\n::: columns\n::: {.column width=\"60%\"}\n![](figs/manuscript-template-head.png)\n:::\n\n::: {.column width=\"40%\"}\n-   YAML header to specify title, output format, bib file, citation style\n\n-   `<br>` for line breaks; `#####` for page breaks\n\n-   Can use latex for equations\n:::\n:::\n\n## Manuscript folder contents\n\n::: columns\n::: {.column width=\"40%\"}\n![](figs/manuscript-folder-contents.png)\n:::\n\n::: {.column width=\"60%\"}\n-   **Reference manuscript:** set format for headers, table of content, etc.\n\n-   **.csl file** specifies citation format (AMA format with numbers in brackets)\n\n-   **.bib file** contains references to cite by citation code, e.g., `[@russell2021a]`\n:::\n:::\n\n## Screenshot of \"knit\" manuscript\n\n::: columns\n::: {.column width=\"70%\"}\n![](figs/manuscript-knit-to-word.png)\n:::\n\n::: {.column width=\"30%\"}\n-   Normal word document\n\n-   Collaborators track changes and return\n\n-   I manually update .Rmd (annoying)\n:::\n:::\n\n## Citations: Zotero → Bibtex → .Rmd\n\n::: columns\n::: {.column width=\"40%\"}\n![](figs/zotero-screenshots.png)\n:::\n\n::: {.column width=\"60%\"}\n-   Export Zotero collection to Bibtex in same folder as .Rmd\n\n-   To replace default CiteKey, add `Citation Key: <CiteKey>` to 'extra' field\n\n-   In .Rmd header, set `bibliography: [filename].bib`\n\n-   Cite with `[@CiteKey]` or `[@CiteKey1; @CiteKey2]`\n:::\n:::\n\n## Zenodo repository\n\n<https://zenodo.org/>\n\n-   Permanent\n\n-   Assigned a DOI (citable)\n\n-   Can drag-and-drop files or auto-add a 'release' from Github\n\n## Agenda\n\n-   Overview\n\n-   My workflow\n\n-   **Example**\n\n## Evaluating quarantine and testing policies for arriving travelers\n\n-   Manuscript: <https://doi.org/10.1101/2020.11.02.20224568>\n\n-   Zenodo repository: <https://doi.org/10.5281/zenodo.4107124>\n\n-   Github repository: <https://github.com/altonrus/quarantineTesting>\n\n-   Shiny app: <https://shiny.mchi.mcgill.ca/arussel/quarantineTesting/>\n\n## Learn more\n\n-   [Decision modeling lab manual](https://altonrus.quarto.pub/decision-modeling-lab-manual/)\n\n-   [Reproducible Analytical Pipelines Course](https://rap4mads.eu/) by Bruno Rodrigues\n\n-   [Reproducible research in R workshop materials](https://r-cubed.rostools.org/index.html) by Luke Johnston et. al.\n\n-   [\"Telling Stories with Data\"](https://tellingstorieswithdata.com/04-workflow.html) Ch. 4 by Rohan Alexander\n\n-   [Intro to Dockers for R Users](https://colinfay.me/docker-r-reproducibility/) by Colin Fay\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    function fireSlideChanged(previousSlide, currentSlide) {\n\n      // dispatch for htmlwidgets\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for reveal\n    if (window.Reveal) {\n      window.Reveal.addEventListener(\"slidechanged\", function(event) {\n        fireSlideChanged(event.previousSlide, event.currentSlide);\n      });\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}